<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-29e2c20b02301cfff04dc8050bf30c7e.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-43df0d6f53b733b42d37fa7808e17715.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-5a965d03c83b9a52a3a52c83f34fadca.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-03f81fcb35c69179f531195cac5ac726.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.34" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.34</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.34">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Users</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Usage Tips</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL in Depth</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/dev-model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-24.908169524002304</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-24.908169524002304</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.33393   -3.97098  -5.52116   -5.08901   …  -6.56993   -5.79087   -7.04147
  1.49329    1.6371   -0.361767   0.612393     -0.590066   0.525466   1.44259
  0.216681   1.74812   3.84011    5.4034        4.45863    5.17368    3.64791</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.00038     0.98854
 -0.00190252  0.993594
  5.01813     0.989539</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip750">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip750)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip751">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip750)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip752">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip752)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip752)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip752)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip752)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip752)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip752)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1540.85 2640.76,1540.85 "></polyline>
<polyline clip-path="url(#clip752)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1240.35 2640.76,1240.35 "></polyline>
<polyline clip-path="url(#clip752)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,939.841 2640.76,939.841 "></polyline>
<polyline clip-path="url(#clip752)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,639.336 2640.76,639.336 "></polyline>
<polyline clip-path="url(#clip752)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,338.831 2640.76,338.831 "></polyline>
<polyline clip-path="url(#clip750)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip750)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip750)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip750)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip750)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip750)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip750)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip750)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip750)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1540.85 170.644,1540.85 "></polyline>
<polyline clip-path="url(#clip750)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1240.35 170.644,1240.35 "></polyline>
<polyline clip-path="url(#clip750)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,939.841 170.644,939.841 "></polyline>
<polyline clip-path="url(#clip750)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,639.336 170.644,639.336 "></polyline>
<polyline clip-path="url(#clip750)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,338.831 170.644,338.831 "></polyline>
<path clip-path="url(#clip750)" d="M49.5521 1541.3 L79.2279 1541.3 L79.2279 1545.24 L49.5521 1545.24 L49.5521 1541.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M99.8991 1538.99 Q96.7509 1538.99 94.8991 1541.14 Q93.0704 1543.29 93.0704 1547.04 Q93.0704 1550.77 94.8991 1552.95 Q96.7509 1555.1 99.8991 1555.1 Q103.047 1555.1 104.876 1552.95 Q106.728 1550.77 106.728 1547.04 Q106.728 1543.29 104.876 1541.14 Q103.047 1538.99 99.8991 1538.99 M109.181 1524.33 L109.181 1528.59 Q107.422 1527.76 105.617 1527.32 Q103.834 1526.88 102.075 1526.88 Q97.4454 1526.88 94.9917 1530.01 Q92.5612 1533.13 92.2139 1539.45 Q93.5797 1537.44 95.6398 1536.37 Q97.7 1535.28 100.177 1535.28 Q105.385 1535.28 108.394 1538.46 Q111.427 1541.6 111.427 1547.04 Q111.427 1552.37 108.279 1555.58 Q105.131 1558.8 99.8991 1558.8 Q93.9037 1558.8 90.7325 1554.22 Q87.5612 1549.61 87.5612 1540.89 Q87.5612 1532.69 91.45 1527.83 Q95.3389 1522.95 101.89 1522.95 Q103.649 1522.95 105.431 1523.29 Q107.237 1523.64 109.181 1524.33 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M50.3623 1240.8 L80.0381 1240.8 L80.0381 1244.73 L50.3623 1244.73 L50.3623 1240.8 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M104.297 1238.99 Q107.654 1239.71 109.529 1241.98 Q111.427 1244.25 111.427 1247.58 Q111.427 1252.7 107.908 1255.5 Q104.39 1258.3 97.9083 1258.3 Q95.7324 1258.3 93.4176 1257.86 Q91.126 1257.44 88.6723 1256.58 L88.6723 1252.07 Q90.6167 1253.2 92.9315 1253.78 Q95.2463 1254.36 97.7695 1254.36 Q102.168 1254.36 104.459 1252.63 Q106.774 1250.89 106.774 1247.58 Q106.774 1244.52 104.621 1242.81 Q102.492 1241.08 98.6722 1241.08 L94.6445 1241.08 L94.6445 1237.23 L98.8574 1237.23 Q102.306 1237.23 104.135 1235.87 Q105.964 1234.48 105.964 1231.89 Q105.964 1229.22 104.066 1227.81 Q102.191 1226.38 98.6722 1226.38 Q96.7509 1226.38 94.5519 1226.79 Q92.3528 1227.21 89.7139 1228.09 L89.7139 1223.92 Q92.376 1223.18 94.6908 1222.81 Q97.0287 1222.44 99.0889 1222.44 Q104.413 1222.44 107.515 1224.87 Q110.617 1227.28 110.617 1231.4 Q110.617 1234.27 108.973 1236.26 Q107.33 1238.23 104.297 1238.99 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M99.4824 925.64 Q95.8713 925.64 94.0426 929.204 Q92.2371 932.746 92.2371 939.876 Q92.2371 946.982 94.0426 950.547 Q95.8713 954.088 99.4824 954.088 Q103.117 954.088 104.922 950.547 Q106.751 946.982 106.751 939.876 Q106.751 932.746 104.922 929.204 Q103.117 925.64 99.4824 925.64 M99.4824 921.936 Q105.293 921.936 108.348 926.542 Q111.427 931.126 111.427 939.876 Q111.427 948.602 108.348 953.209 Q105.293 957.792 99.4824 957.792 Q93.6723 957.792 90.5936 953.209 Q87.538 948.602 87.538 939.876 Q87.538 931.126 90.5936 926.542 Q93.6723 921.936 99.4824 921.936 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M104.297 637.982 Q107.654 638.699 109.529 640.968 Q111.427 643.236 111.427 646.569 Q111.427 651.685 107.908 654.486 Q104.39 657.287 97.9083 657.287 Q95.7324 657.287 93.4176 656.847 Q91.126 656.431 88.6723 655.574 L88.6723 651.06 Q90.6167 652.194 92.9315 652.773 Q95.2463 653.352 97.7695 653.352 Q102.168 653.352 104.459 651.616 Q106.774 649.88 106.774 646.569 Q106.774 643.514 104.621 641.801 Q102.492 640.065 98.6722 640.065 L94.6445 640.065 L94.6445 636.222 L98.8574 636.222 Q102.306 636.222 104.135 634.857 Q105.964 633.468 105.964 630.875 Q105.964 628.213 104.066 626.801 Q102.191 625.366 98.6722 625.366 Q96.7509 625.366 94.5519 625.783 Q92.3528 626.199 89.7139 627.079 L89.7139 622.912 Q92.376 622.171 94.6908 621.801 Q97.0287 621.431 99.0889 621.431 Q104.413 621.431 107.515 623.861 Q110.617 626.269 110.617 630.389 Q110.617 633.259 108.973 635.25 Q107.33 637.218 104.297 637.982 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M99.8991 336.967 Q96.7509 336.967 94.8991 339.12 Q93.0704 341.273 93.0704 345.023 Q93.0704 348.75 94.8991 350.925 Q96.7509 353.078 99.8991 353.078 Q103.047 353.078 104.876 350.925 Q106.728 348.75 106.728 345.023 Q106.728 341.273 104.876 339.12 Q103.047 336.967 99.8991 336.967 M109.181 322.314 L109.181 326.574 Q107.422 325.74 105.617 325.301 Q103.834 324.861 102.075 324.861 Q97.4454 324.861 94.9917 327.986 Q92.5612 331.111 92.2139 337.43 Q93.5797 335.416 95.6398 334.351 Q97.7 333.263 100.177 333.263 Q105.385 333.263 108.394 336.435 Q111.427 339.583 111.427 345.023 Q111.427 350.347 108.279 353.564 Q105.131 356.782 99.8991 356.782 Q93.9037 356.782 90.7325 352.199 Q87.5612 347.592 87.5612 338.865 Q87.5612 330.671 91.45 325.81 Q95.3389 320.926 101.89 320.926 Q103.649 320.926 105.431 321.273 Q107.237 321.62 109.181 322.314 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip752)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1273.8 224.541,1301.42 226.891,1583.98 229.242,1459.57 231.592,1415.27 233.943,1260.06 236.293,1458.16 238.644,1219.65 240.994,1577.35 243.345,1582.76 245.695,1466.6 248.046,1375.4 250.396,1404.55 252.747,1564.61 255.097,1465.61 257.448,1507.92 259.798,1561.8 262.148,1442.89 264.499,1260.14 266.849,1263.49 269.2,1395.27 271.55,1462.15 273.901,1402 276.251,1369.91 278.602,1659.93 280.952,1307.73 283.303,1510.86 285.653,1751.15 288.004,1491.82 290.354,1672.18 292.705,1649.97 295.055,1463.51 297.406,1262.59 299.756,1306.92 302.107,1361.72 304.457,1575.67 306.807,1398.14 309.158,1548.09 311.508,1295.23 313.859,1428.89 316.209,1470.03 318.56,1403.88 320.91,1385.97 323.261,1382.87 325.611,1181.68 327.962,1430.57 330.312,1467.41 332.663,1377.49 335.013,1468.5 337.364,1545.22 339.714,1453.31 342.065,1426.86 344.415,1543.44 346.765,1420.57 349.116,1381.21 351.466,1602.71 353.817,1459.19 356.167,1455.03 358.518,1267.35 360.868,1610.63 363.219,1550.09 365.569,1393.74 367.92,1559.13 370.27,1356.42 372.621,1575.31 374.971,1448.92 377.322,1437.3 379.672,1490.32 382.023,1393.53 384.373,1517.17 386.724,1380.02 389.074,1448.71 391.424,1320.46 393.775,1374.76 396.125,1585.59 398.476,1521.18 400.826,1504.19 403.177,1437.75 405.527,1372.13 407.878,1438.06 410.228,1442.83 412.579,1353.37 414.929,1551.13 417.28,1600.62 419.63,1427.34 421.981,1617.25 424.331,1465.17 426.682,1487.37 429.032,1565.84 431.382,1475.92 433.733,1426.12 436.083,1552.55 438.434,1528.25 440.784,1415.87 443.135,1715.15 445.485,1448.21 447.836,1372.72 450.186,1364.91 452.537,1326.59 454.887,1361.59 457.238,1405.6 459.588,1469.94 461.939,1482.35 464.289,1530.9 466.64,1536.63 468.99,1455.87 471.341,1509.08 473.691,1388.34 476.041,1371.24 478.392,1259.5 480.742,1447.02 483.093,1403.95 485.443,1541.96 487.794,1517.03 490.144,1303.74 492.495,1440.84 494.845,1395.22 497.196,1482.13 499.546,1562.57 501.897,1571.02 504.247,1386.14 506.598,1402.7 508.948,1367.92 511.299,1488.94 513.649,1466.81 515.999,1569.94 518.35,1538.79 520.7,1434.92 523.051,1595.64 525.401,1412.2 527.752,1495.98 530.102,1532.84 532.453,1505.17 534.803,1357.48 537.154,1401.6 539.504,1506.91 541.855,1463.18 544.205,1422.51 546.556,1390.64 548.906,1253.37 551.257,1495.46 553.607,1476.31 555.958,1440.58 558.308,1531.29 560.658,1522.68 563.009,1624.33 565.359,1552.03 567.71,1407.85 570.06,1395.34 572.411,1477.5 574.761,1405.12 577.112,1374.5 579.462,1360.12 581.813,1351.55 584.163,1382.01 586.514,1338.14 588.864,1416.03 591.215,1439.45 593.565,1252.24 595.916,1429.46 598.266,1641.14 600.616,1448.22 602.967,1559 605.317,1395.66 607.668,1540.62 610.018,1279.99 612.369,1290.9 614.719,1415.07 617.07,1414.08 619.42,1530.96 621.771,1503.37 624.121,1557.02 626.472,1470.34 628.822,1480.88 631.173,1612.72 633.523,1493.17 635.874,1321.61 638.224,1367.47 640.575,1452.25 642.925,1501.61 645.275,1512.65 647.626,1525.4 649.976,1355.16 652.327,1423.88 654.677,1409.59 657.028,1529.19 659.378,1661.25 661.729,1602.01 664.079,1395.8 666.43,1317.98 668.78,1342.27 671.131,1461.27 673.481,1547.84 675.832,1317.14 678.182,1438.98 680.533,1504.45 682.883,1420.18 685.233,1361.94 687.584,1457.62 689.934,1418.34 692.285,1520.91 694.635,1514.73 696.986,1248.63 699.336,1336.74 701.687,1269.08 704.037,1189.91 706.388,1381.76 708.738,1394.28 711.089,1298.34 713.439,1436.87 715.79,1524.89 718.14,1406.39 720.491,1435.69 722.841,1401.75 725.192,1509.26 727.542,1518.81 729.892,1355.01 732.243,1331.65 734.593,1490.46 736.944,1485.44 739.294,1341.73 741.645,1412.7 743.995,1449.59 746.346,1420.52 748.696,1431.9 751.047,1293.83 753.397,1478.11 755.748,1516.56 758.098,1394.36 760.449,1317.21 762.799,1474.16 765.15,1388.41 767.5,1318.84 769.85,1493.31 772.201,1420.49 774.551,1429.08 776.902,1579.17 779.252,1276.68 781.603,1328.07 783.953,1409.81 786.304,1414.65 788.654,1471.55 791.005,1443.75 793.355,1550.63 795.706,1468.65 798.056,1436.21 800.407,1551.99 802.757,1348.88 805.108,1550.41 807.458,1393.99 809.809,1383.89 812.159,1356.57 814.509,1379.67 816.86,1118.35 819.21,1350.04 821.561,1223.25 823.911,1683.66 826.262,1481.42 828.612,1505.78 830.963,1398.4 833.313,1414.64 835.664,1516.54 838.014,1347.63 840.365,1439.6 842.715,1439.32 845.066,1534.92 847.416,1403.47 849.767,1309.27 852.117,1460.23 854.467,1545.96 856.818,1481.27 859.168,1384.28 861.519,1485.85 863.869,1495.5 866.22,1497.83 868.57,1391.19 870.921,1354.68 873.271,1525.06 875.622,1507.87 877.972,1512.08 880.323,1612.09 882.673,1663.38 885.024,1374.51 887.374,1542.27 889.725,1403 892.075,1365.78 894.426,1379.15 896.776,1454.1 899.126,1267.05 901.477,1404.65 903.827,1278.13 906.178,1413.32 908.528,1461.45 910.879,1486.28 913.229,1495.35 915.58,1533.89 917.93,1416.05 920.281,1567.4 922.631,1443.88 924.982,1517.32 927.332,1488.47 929.683,1531.4 932.033,1495.24 934.384,1367.53 936.734,1575.58 939.084,1398.4 941.435,1318.18 943.785,1437.38 946.136,1522.82 948.486,1324.37 950.837,1322.12 953.187,1337.52 955.538,1458.92 957.888,1448.68 960.239,1666.09 962.589,1468.82 964.94,1537.37 967.29,1472.45 969.641,1416.21 971.991,1661.74 974.342,1505.21 976.692,1368.59 979.043,1639.07 981.393,1292.47 983.743,1585.36 986.094,1316.71 988.444,1312.42 990.795,1490.07 993.145,1533.84 995.496,1285.66 997.846,1480.62 1000.2,1445.82 1002.55,1362.57 1004.9,1326 1007.25,1300.26 1009.6,1409.4 1011.95,1525.41 1014.3,1693.34 1016.65,1485.41 1019,1245.24 1021.35,1383.24 1023.7,1383.02 1026.05,1334.25 1028.4,1348.31 1030.75,1512.79 1033.1,1375.1 1035.45,1526.88 1037.8,1398.16 1040.15,1348.65 1042.51,1581.35 1044.86,1290.33 1047.21,1621.07 1049.56,1411.73 1051.91,1406.66 1054.26,1302.88 1056.61,1516.79 1058.96,1268.4 1061.31,1542.66 1063.66,1619.37 1066.01,1269.05 1068.36,1272.75 1070.71,1384.94 1073.06,1355.43 1075.41,1318.15 1077.76,1433.01 1080.11,1502.92 1082.46,1523.28 1084.81,1216.71 1087.16,1292.98 1089.51,1284.77 1091.87,1505.64 1094.22,1425.09 1096.57,1386.81 1098.92,1460.27 1101.27,1383.2 1103.62,1421.17 1105.97,1255.03 1108.32,1251.78 1110.67,1334.98 1113.02,1317.39 1115.37,1592.56 1117.72,1482.02 1120.07,1423.24 1122.42,1417.42 1124.77,1320.72 1127.12,1528.71 1129.47,1458.28 1131.82,1527.55 1134.17,1668.58 1136.52,1636.07 1138.87,1513.73 1141.23,1364.28 1143.58,1445.6 1145.93,1533.55 1148.28,1449.08 1150.63,1427.35 1152.98,1371.04 1155.33,1444.42 1157.68,1557.91 1160.03,1422.49 1162.38,1400.9 1164.73,1680.92 1167.08,1361.51 1169.43,1589.13 1171.78,1233.91 1174.13,1457.94 1176.48,1440.08 1178.83,1401.56 1181.18,1399.54 1183.53,1591.65 1185.88,1481.35 1188.23,1430 1190.59,1307.68 1192.94,1573.31 1195.29,1517.45 1197.64,1468.89 1199.99,1507.76 1202.34,1428.35 1204.69,1444.4 1207.04,1580.76 1209.39,1376.95 1211.74,1352 1214.09,1589.21 1216.44,1456.57 1218.79,1351.63 1221.14,1399.4 1223.49,1648.5 1225.84,1533.93 1228.19,1580.58 1230.54,1318.46 1232.89,1314.92 1235.24,1471.49 1237.59,1403.89 1239.94,1205.94 1242.3,1533.91 1244.65,1335.91 1247,1373.37 1249.35,1469.13 1251.7,1523.33 1254.05,1680.94 1256.4,1345.42 1258.75,1563.64 1261.1,1410.36 1263.45,1442.61 1265.8,1276.99 1268.15,1362.96 1270.5,1297.67 1272.85,1402.85 1275.2,1435.18 1277.55,1279.34 1279.9,1375.36 1282.25,1507.49 1284.6,1344.19 1286.95,1488.58 1289.3,1407.77 1291.66,1438.58 1294.01,1384.62 1296.36,1316.84 1298.71,1491.66 1301.06,1405.61 1303.41,1327.38 1305.76,1414.85 1308.11,1270.82 1310.46,1205.28 1312.81,1358.96 1315.16,1281.6 1317.51,1397.92 1319.86,1393.66 1322.21,1346.24 1324.56,1407.08 1326.91,1415.27 1329.26,1473.99 1331.61,1389.03 1333.96,1250.24 1336.31,1401.7 1338.66,1280.94 1341.02,1406.97 1343.37,1517.11 1345.72,1497.37 1348.07,1330.54 1350.42,1293.78 1352.77,1479.66 1355.12,1615.02 1357.47,1386.76 1359.82,1430.32 1362.17,1319.47 1364.52,1449.43 1366.87,1357.72 1369.22,1328.14 1371.57,1423.82 1373.92,1599.05 1376.27,1370.03 1378.62,1407.23 1380.97,1453.61 1383.32,1378.06 1385.67,1469.19 1388.02,1361.56 1390.38,1335.51 1392.73,1350.63 1395.08,1408.67 1397.43,1467.93 1399.78,1432.48 1402.13,1393.42 1404.48,1425.65 1406.83,1421.1 1409.18,1404.12 1411.53,1558.35 1413.88,1386.6 1416.23,1442.16 1418.58,1454.05 1420.93,1429.46 1423.28,1380.77 1425.63,1400.51 1427.98,1524.8 1430.33,1395.59 1432.68,1419.62 1435.03,1345.47 1437.38,1261.33 1439.74,1609.62 1442.09,1478.49 1444.44,1419.12 1446.79,1359.14 1449.14,1536.54 1451.49,1485.54 1453.84,1513.59 1456.19,1500.35 1458.54,1544.68 1460.89,1502.59 1463.24,1436.27 1465.59,1371.45 1467.94,1589.41 1470.29,1483.04 1472.64,1512.68 1474.99,1479.36 1477.34,1374.37 1479.69,1474.44 1482.04,1424.41 1484.39,1572.97 1486.74,1403.46 1489.1,1418.37 1491.45,1514.14 1493.8,1617.85 1496.15,1327.68 1498.5,1473.18 1500.85,1450.35 1503.2,1341.02 1505.55,1310.14 1507.9,1447.87 1510.25,1657.25 1512.6,1441.18 1514.95,1481.99 1517.3,1351.44 1519.65,1385.27 1522,1352.54 1524.35,1402.76 1526.7,1364.1 1529.05,1506.15 1531.4,1297.66 1533.75,1546.07 1536.1,1529.9 1538.45,1443.26 1540.81,1398.02 1543.16,1446.43 1545.51,1401.29 1547.86,1356.77 1550.21,1340.58 1552.56,1337.63 1554.91,1471.16 1557.26,1423.71 1559.61,1403.46 1561.96,1451.01 1564.31,1376.53 1566.66,1515.12 1569.01,1523.25 1571.36,1595.51 1573.71,1436.52 1576.06,1397.63 1578.41,1508.42 1580.76,1329.86 1583.11,1446.66 1585.46,1492.13 1587.81,1329.95 1590.17,1461.59 1592.52,1487.73 1594.87,1353.91 1597.22,1506.65 1599.57,1631.84 1601.92,1138.41 1604.27,1522.18 1606.62,1328.32 1608.97,1541.14 1611.32,1419.32 1613.67,1425.91 1616.02,1375.91 1618.37,1293.55 1620.72,1639.3 1623.07,1340.83 1625.42,1340.07 1627.77,1351.71 1630.12,1376.14 1632.47,1349.76 1634.82,1267.87 1637.17,1352.47 1639.53,1382.71 1641.88,1544.05 1644.23,1512.3 1646.58,1368.4 1648.93,1462.54 1651.28,1552.23 1653.63,1556.43 1655.98,1391.71 1658.33,1509.66 1660.68,1481.3 1663.03,1438.76 1665.38,1350.73 1667.73,1477.27 1670.08,1474.99 1672.43,1456.75 1674.78,1444.61 1677.13,1451.62 1679.48,1357.16 1681.83,1627.55 1684.18,1492.79 1686.53,1491.77 1688.89,1472.92 1691.24,1421.13 1693.59,1441.61 1695.94,1280 1698.29,1501.15 1700.64,1387.84 1702.99,1506.34 1705.34,1486.92 1707.69,1464.52 1710.04,1635.8 1712.39,1433.15 1714.74,1509.59 1717.09,1431.14 1719.44,1380.27 1721.79,1593.5 1724.14,1326.84 1726.49,1444.93 1728.84,1644.8 1731.19,1573.9 1733.54,1541.98 1735.89,1457.4 1738.25,1326.74 1740.6,1413.17 1742.95,1472.14 1745.3,1375.97 1747.65,1464.82 1750,1416.17 1752.35,1454.67 1754.7,1391.07 1757.05,1509.39 1759.4,1484.5 1761.75,1554.18 1764.1,1465.3 1766.45,1407.37 1768.8,1377.51 1771.15,1499.03 1773.5,1483.79 1775.85,1368.53 1778.2,1337.6 1780.55,1538.13 1782.9,1451.24 1785.25,1414.81 1787.6,1412.82 1789.96,1470.93 1792.31,1581.32 1794.66,1436.71 1797.01,1369.08 1799.36,1239.41 1801.71,1474.47 1804.06,1418.46 1806.41,1310.67 1808.76,1453.11 1811.11,1566.41 1813.46,1450.03 1815.81,1434.23 1818.16,1366.99 1820.51,1339.19 1822.86,1465.92 1825.21,1534.36 1827.56,1438.47 1829.91,1357.09 1832.26,1461.38 1834.61,1321.69 1836.96,1475.95 1839.32,1339.36 1841.67,1480.94 1844.02,1586.78 1846.37,1406.81 1848.72,1547.89 1851.07,1467.11 1853.42,1424.25 1855.77,1463.65 1858.12,1590.94 1860.47,1536.72 1862.82,1515.23 1865.17,1641.97 1867.52,1554.09 1869.87,1448.13 1872.22,1290.29 1874.57,1344.13 1876.92,1425.68 1879.27,1289.81 1881.62,1401.04 1883.97,1303.45 1886.32,1411.35 1888.68,1430.66 1891.03,1585.57 1893.38,1430.46 1895.73,1452.6 1898.08,1634.51 1900.43,1491.84 1902.78,1541.25 1905.13,1331.01 1907.48,1424.72 1909.83,1461.66 1912.18,1234.7 1914.53,1262.1 1916.88,1372.88 1919.23,1589.9 1921.58,1570.44 1923.93,1487.57 1926.28,1528.03 1928.63,1437.13 1930.98,1384.94 1933.33,1482.92 1935.68,1550.06 1938.04,1453.13 1940.39,1372.96 1942.74,1484.41 1945.09,1611.07 1947.44,1516.61 1949.79,1462.52 1952.14,1369.97 1954.49,1430.51 1956.84,1371.75 1959.19,1502.02 1961.54,1520.28 1963.89,1477.47 1966.24,1372.75 1968.59,1599.2 1970.94,1370.16 1973.29,1364.16 1975.64,1533.25 1977.99,1430.35 1980.34,1380.93 1982.69,1488.27 1985.04,1464.24 1987.4,1410.87 1989.75,1574.91 1992.1,1466.85 1994.45,1384.13 1996.8,1461.93 1999.15,1363.97 2001.5,1323.75 2003.85,1322.32 2006.2,1524 2008.55,1572.52 2010.9,1420.48 2013.25,1409.35 2015.6,1530.56 2017.95,1665.06 2020.3,1416.14 2022.65,1470.01 2025,1414.04 2027.35,1144.64 2029.7,1448.48 2032.05,1353.51 2034.4,1547.55 2036.76,1543.31 2039.11,1357.96 2041.46,1357.68 2043.81,1399.92 2046.16,1483.4 2048.51,1505.81 2050.86,1324.12 2053.21,1316.67 2055.56,1505.61 2057.91,1563.39 2060.26,1431.41 2062.61,1391.99 2064.96,1513.71 2067.31,1526.97 2069.66,1475.42 2072.01,1357.98 2074.36,1562.29 2076.71,1394.84 2079.06,1401.62 2081.41,1376.18 2083.76,1453.37 2086.11,1273.11 2088.47,1443.72 2090.82,1415.51 2093.17,1415.99 2095.52,1292.23 2097.87,1360.01 2100.22,1589.26 2102.57,1366.34 2104.92,1679.95 2107.27,1538.54 2109.62,1390.61 2111.97,1304.21 2114.32,1468.21 2116.67,1517.64 2119.02,1565.98 2121.37,1531.2 2123.72,1433.1 2126.07,1400.65 2128.42,1360.29 2130.77,1465.22 2133.12,1509.83 2135.47,1586.13 2137.83,1363.81 2140.18,1423 2142.53,1224.13 2144.88,1633.69 2147.23,1429.35 2149.58,1477.83 2151.93,1388.25 2154.28,1509.29 2156.63,1485.7 2158.98,1284.46 2161.33,1472.9 2163.68,1386.37 2166.03,1463.36 2168.38,1413.42 2170.73,1393.28 2173.08,1412.33 2175.43,1494.1 2177.78,1497.97 2180.13,1417.36 2182.48,1370.96 2184.83,1599.92 2187.19,1600.11 2189.54,1485.1 2191.89,1384.03 2194.24,1382.66 2196.59,1386.18 2198.94,1478.32 2201.29,1366.59 2203.64,1489.62 2205.99,1543.16 2208.34,1482.14 2210.69,1575.39 2213.04,1483.22 2215.39,1639.98 2217.74,1580.36 2220.09,1528.36 2222.44,1310.9 2224.79,1509.22 2227.14,1548.56 2229.49,1284.84 2231.84,1365.09 2234.19,1591.34 2236.55,1372.52 2238.9,1544.19 2241.25,1426.77 2243.6,1346.22 2245.95,1500.93 2248.3,1253.1 2250.65,1445.93 2253,1378.06 2255.35,1501.26 2257.7,1599.71 2260.05,1489.32 2262.4,1447.94 2264.75,1537.26 2267.1,1377.52 2269.45,1410.59 2271.8,1414.79 2274.15,1585.99 2276.5,1561.65 2278.85,1539.61 2281.2,1342.66 2283.55,1481.79 2285.91,1467.84 2288.26,1400.09 2290.61,1321.55 2292.96,1433.88 2295.31,1521.91 2297.66,1410.04 2300.01,1458.2 2302.36,1411.76 2304.71,1257.69 2307.06,1417.58 2309.41,1481.81 2311.76,1318.65 2314.11,1525.46 2316.46,1444.35 2318.81,1439.8 2321.16,1393.59 2323.51,1514.56 2325.86,1294.09 2328.21,1364.03 2330.56,1275.7 2332.91,1445.23 2335.27,1522.85 2337.62,1395.87 2339.97,1331.95 2342.32,1347.84 2344.67,1483.7 2347.02,1343.86 2349.37,1461.21 2351.72,1548.69 2354.07,1289.79 2356.42,1573.66 2358.77,1536.56 2361.12,1426 2363.47,1306.31 2365.82,1227.23 2368.17,1529.31 2370.52,1450.13 2372.87,1308.17 2375.22,1283.49 2377.57,1366.36 2379.92,1548.78 2382.27,1412.6 2384.62,1436.28 2386.98,1506.03 2389.33,1361.15 2391.68,1447.01 2394.03,1394.87 2396.38,1335.42 2398.73,1290.12 2401.08,1540.21 2403.43,1491.24 2405.78,1291.66 2408.13,1392.31 2410.48,1529.78 2412.83,1618.69 2415.18,1335.75 2417.53,1404.88 2419.88,1313.72 2422.23,1498.51 2424.58,1473 2426.93,1595.93 2429.28,1418.21 2431.63,1372.85 2433.98,1497.63 2436.34,1450.8 2438.69,1506.68 2441.04,1325.29 2443.39,1343.91 2445.74,1423.86 2448.09,1310.93 2450.44,1343.66 2452.79,1487.25 2455.14,1547.24 2457.49,1431.68 2459.84,1521.34 2462.19,1306.65 2464.54,1374.11 2466.89,1608.43 2469.24,1395.53 2471.59,1435.73 2473.94,1400.23 2476.29,1355.09 2478.64,1419.46 2480.99,1522.86 2483.34,1585.63 2485.7,1691.07 2488.05,1495.95 2490.4,1433.46 2492.75,1596.18 2495.1,1430.24 2497.45,1238.19 2499.8,1494.91 2502.15,1407.04 2504.5,1435.94 2506.85,1443.31 2509.2,1495.73 2511.55,1462.26 2513.9,1272.39 2516.25,1445.41 2518.6,1501.64 2520.95,1384.62 2523.3,1354.73 2525.65,1450.34 2528,1456.33 2530.35,1501.11 2532.7,1419.01 2535.06,1503.67 2537.41,1450.04 2539.76,1504.03 2542.11,1246.42 2544.46,1384.94 2546.81,1258.54 2549.16,1496.71 2551.51,1560.14 2553.86,1460.12 2556.21,1289.42 2558.56,1576.05 2560.91,1369.8 2563.26,1507.96 2565.61,1440.36 2567.96,1352.9 2570.31,1329.24 "></polyline>
<polyline clip-path="url(#clip752)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,790.261 224.541,1008.71 226.891,916.08 229.242,881.288 231.592,1105.97 233.943,1099.91 236.293,951.65 238.644,891.881 240.994,974.533 243.345,805.143 245.695,742.834 248.046,996.664 250.396,854.918 252.747,914.947 255.097,991.38 257.448,859.866 259.798,1022.63 262.148,950.245 264.499,1071.02 266.849,1089.06 269.2,856.301 271.55,1055.38 273.901,1002.11 276.251,962.154 278.602,988.858 280.952,961.286 283.303,768.181 285.653,848.127 288.004,957.688 290.354,1090.71 292.705,1057.29 295.055,942.261 297.406,1005.2 299.756,1130.71 302.107,1027.56 304.457,1025.01 306.807,907.156 309.158,1039.67 311.508,1016.69 313.859,1001.94 316.209,803.786 318.56,1016.44 320.91,973.719 323.261,969.979 325.611,995.832 327.962,892.678 330.312,1009.75 332.663,918.052 335.013,1107.92 337.364,678.325 339.714,909.971 342.065,826.961 344.415,1091.27 346.765,1011.28 349.116,1020.47 351.466,772.577 353.817,862.672 356.167,819.56 358.518,968.466 360.868,1024.22 363.219,903.616 365.569,887.573 367.92,1010.37 370.27,893.854 372.621,975.315 374.971,863.02 377.322,1112.42 379.672,861.571 382.023,853.939 384.373,1011.11 386.724,808.746 389.074,880.084 391.424,884.746 393.775,876.567 396.125,1045.33 398.476,994.266 400.826,990.63 403.177,987.57 405.527,889.923 407.878,940.303 410.228,955.627 412.579,857.217 414.929,887.517 417.28,783.957 419.63,923.395 421.981,987.485 424.331,964.512 426.682,1100.71 429.032,1027.61 431.382,832.502 433.733,819.449 436.083,941.571 438.434,1035.28 440.784,866.105 443.135,749.605 445.485,933.108 447.836,819.62 450.186,899.73 452.537,977.215 454.887,949.802 457.238,839.755 459.588,833.126 461.939,880.507 464.289,1079.7 466.64,908.945 468.99,1114.51 471.341,816.759 473.691,628.727 476.041,900.577 478.392,1013.2 480.742,916.341 483.093,836.264 485.443,905.294 487.794,1099.43 490.144,805.154 492.495,997.837 494.845,1198.98 497.196,955.232 499.546,814.439 501.897,939.619 504.247,987.906 506.598,845.334 508.948,977.293 511.299,904.038 513.649,920.718 515.999,898.886 518.35,1010.62 520.7,884.645 523.051,829.061 525.401,978.31 527.752,893.799 530.102,910.126 532.453,980.472 534.803,929.346 537.154,946.832 539.504,934.379 541.855,979.291 544.205,829.786 546.556,886.211 548.906,1014.51 551.257,882.725 553.607,654.984 555.958,951.192 558.308,924.43 560.658,881.097 563.009,985.825 565.359,1120.94 567.71,734.005 570.06,1024.62 572.411,851.557 574.761,697.344 577.112,898.428 579.462,849.928 581.813,955.011 584.163,1144.43 586.514,907.526 588.864,895.624 591.215,1072.64 593.565,1116.27 595.916,997.898 598.266,771.157 600.616,1174.42 602.967,815.841 605.317,950.681 607.668,980.505 610.018,964.442 612.369,833.351 614.719,949.134 617.07,1058.18 619.42,1080.47 621.771,831.635 624.121,1073.81 626.472,943.228 628.822,963.802 631.173,815.921 633.523,1111.51 635.874,1019.02 638.224,1041.32 640.575,826.95 642.925,851.459 645.275,1114.04 647.626,835.053 649.976,940.433 652.327,882.679 654.677,809.014 657.028,977.722 659.378,891.577 661.729,705.991 664.079,1040.47 666.43,906.703 668.78,1007.45 671.131,1002.2 673.481,905.712 675.832,943.794 678.182,866.953 680.533,977.181 682.883,929.768 685.233,812.017 687.584,1012.39 689.934,868.044 692.285,1005.58 694.635,849.599 696.986,1133.11 699.336,1028.65 701.687,890.733 704.037,869.368 706.388,788.446 708.738,916.895 711.089,1012.72 713.439,1028.91 715.79,876.523 718.14,1022.38 720.491,899.479 722.841,918.074 725.192,936.564 727.542,886.547 729.892,1013.31 732.243,1069.73 734.593,863.916 736.944,1070.01 739.294,911.655 741.645,1047.53 743.995,929.106 746.346,905.477 748.696,1139.51 751.047,889.941 753.397,888.928 755.748,861.128 758.098,1048.25 760.449,923.821 762.799,1081.65 765.15,941.57 767.5,932.56 769.85,785.061 772.201,986.08 774.551,1025.78 776.902,1031.69 779.252,944.652 781.603,791.621 783.953,829.146 786.304,826.889 788.654,801.98 791.005,916.435 793.355,1039.05 795.706,930.845 798.056,947.506 800.407,1028.28 802.757,989.498 805.108,1111.5 807.458,1083.88 809.809,783.439 812.159,887.482 814.509,1020.47 816.86,1102.05 819.21,967.309 821.561,1119.11 823.911,872.749 826.262,877.704 828.612,768.832 830.963,943.376 833.313,1075.24 835.664,773.739 838.014,923.226 840.365,1145.32 842.715,776.943 845.066,820.075 847.416,1031.73 849.767,887.207 852.117,1135.67 854.467,1014.79 856.818,988.459 859.168,1048.16 861.519,930.321 863.869,957.749 866.22,832.462 868.57,764.648 870.921,824.959 873.271,1027.2 875.622,772.749 877.972,1060.08 880.323,806.456 882.673,966.955 885.024,1066.19 887.374,893.916 889.725,967.322 892.075,1008.68 894.426,877.91 896.776,1041.89 899.126,855.102 901.477,887.017 903.827,973.011 906.178,883.316 908.528,991.8 910.879,1073.55 913.229,1083.1 915.58,991.422 917.93,980.804 920.281,940.566 922.631,997.782 924.982,895.292 927.332,1073.22 929.683,1129.94 932.033,908.027 934.384,853.838 936.734,909.011 939.084,768.538 941.435,908.07 943.785,1006.22 946.136,930.94 948.486,1005.08 950.837,816.082 953.187,826.433 955.538,1079.55 957.888,1054.29 960.239,787.302 962.589,1035.98 964.94,1020.58 967.29,862.509 969.641,942.808 971.991,998.969 974.342,1061.08 976.692,838.684 979.043,817.389 981.393,1029.38 983.743,836.623 986.094,1150.73 988.444,827.929 990.795,975.779 993.145,961.926 995.496,889.684 997.846,1064.53 1000.2,942.771 1002.55,896.881 1004.9,1076.22 1007.25,1085.6 1009.6,804.056 1011.95,706.43 1014.3,900.125 1016.65,880.367 1019,995.683 1021.35,792.655 1023.7,894.696 1026.05,1045.75 1028.4,851.183 1030.75,904.862 1033.1,1056.2 1035.45,803.611 1037.8,930.792 1040.15,833.176 1042.51,902.278 1044.86,996.657 1047.21,875.17 1049.56,979.874 1051.91,836.011 1054.26,927.839 1056.61,833.553 1058.96,1046.35 1061.31,892.53 1063.66,1139.12 1066.01,790.353 1068.36,870.066 1070.71,1053.86 1073.06,1122.07 1075.41,1053.69 1077.76,912.211 1080.11,832.566 1082.46,928.842 1084.81,743.821 1087.16,952.088 1089.51,1029.99 1091.87,800.475 1094.22,858.696 1096.57,969.775 1098.92,893.698 1101.27,904.805 1103.62,858.732 1105.97,974.915 1108.32,945.244 1110.67,773.941 1113.02,895.299 1115.37,784.582 1117.72,1042.49 1120.07,843.219 1122.42,860.655 1124.77,799.615 1127.12,884.065 1129.47,880.215 1131.82,799.549 1134.17,931.753 1136.52,1113.06 1138.87,893.242 1141.23,923.66 1143.58,916.156 1145.93,923.356 1148.28,1085.79 1150.63,873.548 1152.98,962.281 1155.33,781.653 1157.68,1003.29 1160.03,883.837 1162.38,896.112 1164.73,933.509 1167.08,659.075 1169.43,910.625 1171.78,851.953 1174.13,1033.37 1176.48,1085.96 1178.83,911.819 1181.18,835.31 1183.53,1013.38 1185.88,1053.86 1188.23,735.417 1190.59,824.086 1192.94,1045.16 1195.29,969.921 1197.64,1164.05 1199.99,943.593 1202.34,1050.39 1204.69,1021.56 1207.04,934.078 1209.39,982.731 1211.74,732.814 1214.09,743.803 1216.44,864.789 1218.79,793.146 1221.14,962.281 1223.49,908.433 1225.84,838.999 1228.19,990.511 1230.54,1085.29 1232.89,1008.38 1235.24,935.83 1237.59,873.598 1239.94,1058.88 1242.3,928.519 1244.65,938.53 1247,1026.67 1249.35,901.417 1251.7,1105.47 1254.05,712.129 1256.4,1027.79 1258.75,965.158 1261.1,1005.09 1263.45,850.057 1265.8,894.622 1268.15,952.15 1270.5,854.454 1272.85,923.774 1275.2,939.48 1277.55,852.154 1279.9,796.01 1282.25,981.647 1284.6,823.164 1286.95,1006.75 1289.3,977.739 1291.66,1064.37 1294.01,972.285 1296.36,933.828 1298.71,897.82 1301.06,909.16 1303.41,1099.71 1305.76,908.157 1308.11,889.171 1310.46,1183.17 1312.81,812.376 1315.16,973.459 1317.51,997.905 1319.86,934.327 1322.21,976.772 1324.56,791.483 1326.91,811.21 1329.26,877.443 1331.61,1055.7 1333.96,851.586 1336.31,1005.86 1338.66,862.555 1341.02,943.509 1343.37,924.11 1345.72,760.866 1348.07,1060.03 1350.42,948.208 1352.77,954.027 1355.12,1170.51 1357.47,913.948 1359.82,821.37 1362.17,1046.25 1364.52,991.147 1366.87,866.584 1369.22,1087.07 1371.57,968.84 1373.92,974.492 1376.27,1031.45 1378.62,1201.91 1380.97,940.06 1383.32,968.271 1385.67,1046.93 1388.02,911.61 1390.38,1012 1392.73,998.229 1395.08,906.03 1397.43,834.783 1399.78,852.132 1402.13,866.612 1404.48,1035.09 1406.83,654.085 1409.18,922.035 1411.53,1038.32 1413.88,969.011 1416.23,797.606 1418.58,916.62 1420.93,949.845 1423.28,883.21 1425.63,868.583 1427.98,1162.62 1430.33,991.17 1432.68,882.468 1435.03,1025.87 1437.38,1090.21 1439.74,1036.32 1442.09,824.578 1444.44,892.097 1446.79,1005.95 1449.14,928.557 1451.49,928.268 1453.84,953.414 1456.19,843.201 1458.54,942.522 1460.89,1035.39 1463.24,796.506 1465.59,871.988 1467.94,1045.79 1470.29,946.779 1472.64,1058.58 1474.99,935.656 1477.34,846.81 1479.69,1063.24 1482.04,997.318 1484.39,850.74 1486.74,1004.48 1489.1,971.35 1491.45,967.204 1493.8,1078.25 1496.15,1026.53 1498.5,938.361 1500.85,760.025 1503.2,1003.97 1505.55,761.852 1507.9,907.998 1510.25,790.533 1512.6,991.421 1514.95,921.974 1517.3,978.21 1519.65,960.853 1522,1211.55 1524.35,964.53 1526.7,741.452 1529.05,1025.69 1531.4,941.019 1533.75,882.708 1536.1,1048.15 1538.45,941.105 1540.81,799.025 1543.16,914.164 1545.51,954.064 1547.86,973.195 1550.21,957.779 1552.56,1117.73 1554.91,827.953 1557.26,916.976 1559.61,878.452 1561.96,941.575 1564.31,905.067 1566.66,1034.84 1569.01,958.171 1571.36,918.868 1573.71,887.345 1576.06,912.182 1578.41,971.671 1580.76,962.211 1583.11,1025.42 1585.46,959.358 1587.81,934.954 1590.17,939.021 1592.52,1094.1 1594.87,914.622 1597.22,925.584 1599.57,1066.04 1601.92,963.914 1604.27,1030.88 1606.62,1031.81 1608.97,1096.96 1611.32,1020.14 1613.67,1080.81 1616.02,1005.68 1618.37,954.251 1620.72,798.352 1623.07,918.724 1625.42,714.697 1627.77,1160.24 1630.12,973.002 1632.47,959.235 1634.82,818.743 1637.17,862.368 1639.53,1049.51 1641.88,899.724 1644.23,978.251 1646.58,798.88 1648.93,884.894 1651.28,848.855 1653.63,837.674 1655.98,899.575 1658.33,985.425 1660.68,867.51 1663.03,1012.74 1665.38,861.416 1667.73,932.021 1670.08,843.843 1672.43,980.594 1674.78,1008.66 1677.13,913.276 1679.48,917.041 1681.83,1065.62 1684.18,996.55 1686.53,941.065 1688.89,886.558 1691.24,1123.59 1693.59,1011.47 1695.94,1141.51 1698.29,966.768 1700.64,856.925 1702.99,991.474 1705.34,876.921 1707.69,979.964 1710.04,765.1 1712.39,1104.28 1714.74,983.57 1717.09,1077.26 1719.44,846.209 1721.79,1000.65 1724.14,887.52 1726.49,972.522 1728.84,950.115 1731.19,882.448 1733.54,891.94 1735.89,1062.28 1738.25,866 1740.6,894.462 1742.95,868.839 1745.3,802.522 1747.65,900.502 1750,775.284 1752.35,1003.29 1754.7,828.668 1757.05,904.711 1759.4,1085.34 1761.75,917.165 1764.1,980.06 1766.45,919.865 1768.8,900.433 1771.15,1040.02 1773.5,970.728 1775.85,1142.05 1778.2,859.118 1780.55,1069.48 1782.9,824.312 1785.25,1012.42 1787.6,1046 1789.96,847.804 1792.31,1212.61 1794.66,1014.03 1797.01,983.618 1799.36,693.188 1801.71,1058.17 1804.06,772.732 1806.41,904.88 1808.76,919.082 1811.11,919.812 1813.46,937.643 1815.81,915.207 1818.16,1010.47 1820.51,897.574 1822.86,910.686 1825.21,952.453 1827.56,827.716 1829.91,966.325 1832.26,992.19 1834.61,940.31 1836.96,1023.71 1839.32,904.408 1841.67,789.99 1844.02,962.817 1846.37,989.523 1848.72,823.064 1851.07,913.855 1853.42,702.629 1855.77,1006.48 1858.12,957.769 1860.47,851.059 1862.82,902.649 1865.17,948.412 1867.52,816.085 1869.87,916.141 1872.22,886.219 1874.57,1064.85 1876.92,1085.16 1879.27,986.16 1881.62,855.637 1883.97,1087.31 1886.32,973.429 1888.68,835.896 1891.03,1127.33 1893.38,946.152 1895.73,1076.28 1898.08,1044.85 1900.43,838.925 1902.78,883.336 1905.13,958.311 1907.48,893.712 1909.83,770.129 1912.18,958.785 1914.53,993.207 1916.88,1036.18 1919.23,872.661 1921.58,973.577 1923.93,725.938 1926.28,1009.84 1928.63,1016.16 1930.98,881.391 1933.33,1082.96 1935.68,1103.68 1938.04,1001.27 1940.39,915.5 1942.74,963.342 1945.09,963.795 1947.44,1063.87 1949.79,892.292 1952.14,996.004 1954.49,844.493 1956.84,807.016 1959.19,821.249 1961.54,1016.85 1963.89,943.93 1966.24,1027.01 1968.59,938.059 1970.94,814.184 1973.29,894.165 1975.64,966.821 1977.99,984.951 1980.34,802.536 1982.69,1145.19 1985.04,848.043 1987.4,1095.71 1989.75,1010.66 1992.1,983.874 1994.45,798.38 1996.8,1009.81 1999.15,727.782 2001.5,880.91 2003.85,977.688 2006.2,1041.76 2008.55,947.917 2010.9,1013.65 2013.25,1038.84 2015.6,1070.25 2017.95,1106.07 2020.3,909.347 2022.65,878.348 2025,1026.56 2027.35,794.795 2029.7,984.49 2032.05,827.822 2034.4,945.825 2036.76,920.69 2039.11,1091.09 2041.46,1112.22 2043.81,1173.19 2046.16,941.349 2048.51,1103.26 2050.86,744.908 2053.21,990.117 2055.56,672.518 2057.91,1047.01 2060.26,1068.47 2062.61,823.239 2064.96,828.014 2067.31,729.809 2069.66,1032.15 2072.01,905.35 2074.36,1053.98 2076.71,777.083 2079.06,890.701 2081.41,989.545 2083.76,756.01 2086.11,933.882 2088.47,840.367 2090.82,1141.76 2093.17,1230.36 2095.52,851.394 2097.87,719.213 2100.22,779.679 2102.57,1030.72 2104.92,995.526 2107.27,713.747 2109.62,820.401 2111.97,751.154 2114.32,1126.65 2116.67,1045.98 2119.02,965.519 2121.37,967.489 2123.72,900.023 2126.07,882.72 2128.42,1227.19 2130.77,971.292 2133.12,992.19 2135.47,962.353 2137.83,816.518 2140.18,1003.91 2142.53,940.468 2144.88,810.095 2147.23,750.617 2149.58,929.344 2151.93,1110.41 2154.28,901.705 2156.63,998.874 2158.98,784.504 2161.33,943.57 2163.68,837.419 2166.03,927.273 2168.38,888.508 2170.73,1039.18 2173.08,1078.16 2175.43,786.486 2177.78,815.415 2180.13,961.424 2182.48,907.053 2184.83,1148.31 2187.19,1004.61 2189.54,983.113 2191.89,889.903 2194.24,855.03 2196.59,1184.66 2198.94,953.75 2201.29,798.483 2203.64,993.332 2205.99,975.3 2208.34,905.296 2210.69,794.31 2213.04,949.804 2215.39,1025.06 2217.74,1015.48 2220.09,910.803 2222.44,994.132 2224.79,853.148 2227.14,885.199 2229.49,957.784 2231.84,975.437 2234.19,850.114 2236.55,972.017 2238.9,810.001 2241.25,901.793 2243.6,1005.89 2245.95,962.061 2248.3,1050.38 2250.65,973.041 2253,946.592 2255.35,1052.25 2257.7,779.726 2260.05,1169.53 2262.4,922.872 2264.75,1375.76 2267.1,978.298 2269.45,894.014 2271.8,841.598 2274.15,924.448 2276.5,1034.74 2278.85,961.961 2281.2,1135.95 2283.55,967.085 2285.91,913.994 2288.26,798.373 2290.61,1198.72 2292.96,1067.22 2295.31,937.355 2297.66,1013.86 2300.01,927.444 2302.36,852.678 2304.71,959.866 2307.06,924.195 2309.41,945.287 2311.76,910.529 2314.11,1102.22 2316.46,1044.79 2318.81,799.068 2321.16,864.106 2323.51,1003.62 2325.86,846.008 2328.21,1004.57 2330.56,1065.43 2332.91,1015.14 2335.27,912.14 2337.62,1031.94 2339.97,822.167 2342.32,1000.84 2344.67,976.526 2347.02,1018.92 2349.37,1033.05 2351.72,909.094 2354.07,903.816 2356.42,1049.01 2358.77,1117.44 2361.12,863.772 2363.47,898.556 2365.82,866.954 2368.17,783.168 2370.52,971.59 2372.87,771.503 2375.22,950.998 2377.57,1020.15 2379.92,1102.85 2382.27,1049.31 2384.62,983.235 2386.98,939.234 2389.33,983.127 2391.68,871.794 2394.03,972.709 2396.38,998.685 2398.73,893.944 2401.08,937.683 2403.43,963.993 2405.78,972.181 2408.13,1095.22 2410.48,793.172 2412.83,986.463 2415.18,818.45 2417.53,852.76 2419.88,966.637 2422.23,929.606 2424.58,940.192 2426.93,1039.82 2429.28,938.138 2431.63,823.591 2433.98,1047.67 2436.34,882.649 2438.69,1027.15 2441.04,856.794 2443.39,1040.18 2445.74,900.64 2448.09,755.511 2450.44,1007.65 2452.79,802.445 2455.14,811.619 2457.49,911.071 2459.84,999.909 2462.19,899.628 2464.54,1091.43 2466.89,908.518 2469.24,920.757 2471.59,1028.93 2473.94,919.094 2476.29,1063.41 2478.64,704.48 2480.99,977.193 2483.34,973.069 2485.7,995.257 2488.05,910.867 2490.4,1023.16 2492.75,1021.34 2495.1,960.717 2497.45,822.489 2499.8,955.961 2502.15,912.837 2504.5,893.496 2506.85,963.892 2509.2,837.299 2511.55,999.292 2513.9,1004.82 2516.25,933.037 2518.6,803.85 2520.95,855.421 2523.3,1005.67 2525.65,990.17 2528,1123.63 2530.35,859.496 2532.7,943.012 2535.06,1098.38 2537.41,982.306 2539.76,1040.42 2542.11,793.438 2544.46,845.252 2546.81,1082.11 2549.16,896.091 2551.51,928.073 2553.86,922.082 2556.21,829.318 2558.56,798.15 2560.91,1102.07 2563.26,918.033 2565.61,999.461 2567.96,914.924 2570.31,887.559 "></polyline>
<polyline clip-path="url(#clip752)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,918.136 224.541,443.293 226.891,457.885 229.242,404.497 231.592,467.075 233.943,458.793 236.293,554.024 238.644,588.925 240.994,448.786 243.345,355.398 245.695,254.327 248.046,474.59 250.396,264.109 252.747,328.816 255.097,473.43 257.448,374.253 259.798,384.766 262.148,314.415 264.499,358.128 266.849,568.407 269.2,406.037 271.55,523.393 273.901,599.082 276.251,513.028 278.602,248.758 280.952,349.498 283.303,299.37 285.653,446.207 288.004,399.443 290.354,388.614 292.705,348.19 295.055,457.262 297.406,392.098 299.756,314.735 302.107,474.903 304.457,568.304 306.807,387.998 309.158,452.518 311.508,512.755 313.859,494.301 316.209,409.038 318.56,494.554 320.91,584.254 323.261,498.715 325.611,457.3 327.962,426.845 330.312,622.177 332.663,511.489 335.013,455.325 337.364,416.658 339.714,555.235 342.065,269.871 344.415,529.992 346.765,524.291 349.116,205.729 351.466,614.152 353.817,524.422 356.167,308.11 358.518,353.035 360.868,576.444 363.219,472.004 365.569,299.172 367.92,371.094 370.27,319.89 372.621,367.024 374.971,519.795 377.322,482.083 379.672,511.44 382.023,508.725 384.373,490.181 386.724,443.646 389.074,301.009 391.424,318.85 393.775,677.698 396.125,260.203 398.476,236.431 400.826,319.039 403.177,485.519 405.527,333.222 407.878,522.555 410.228,416.32 412.579,387.019 414.929,397.786 417.28,457.037 419.63,631.232 421.981,409.819 424.331,402.734 426.682,368.245 429.032,410.798 431.382,445.565 433.733,562.369 436.083,565.341 438.434,358.386 440.784,413.298 443.135,307.703 445.485,366.18 447.836,422.001 450.186,475.63 452.537,469.255 454.887,478.685 457.238,406.078 459.588,358.45 461.939,352.962 464.289,522.439 466.64,381.664 468.99,377.502 471.341,373.324 473.691,343.43 476.041,374.623 478.392,620.574 480.742,561.277 483.093,373.685 485.443,265.773 487.794,375.762 490.144,493.001 492.495,398.354 494.845,463.978 497.196,379.813 499.546,509.686 501.897,469.963 504.247,598.124 506.598,503.742 508.948,454.351 511.299,536.251 513.649,343.237 515.999,587.05 518.35,555.068 520.7,516.9 523.051,472.569 525.401,539.879 527.752,603.711 530.102,382.235 532.453,577.743 534.803,548.526 537.154,535.022 539.504,505.633 541.855,483.945 544.205,574.304 546.556,462.848 548.906,527.746 551.257,310.248 553.607,517.776 555.958,323.702 558.308,444.809 560.658,622.599 563.009,522.231 565.359,477.356 567.71,442.059 570.06,461.176 572.411,340.614 574.761,305.122 577.112,277.786 579.462,401.784 581.813,458.668 584.163,455.462 586.514,396.026 588.864,488.206 591.215,484.856 593.565,457.58 595.916,308.292 598.266,326.835 600.616,491.355 602.967,369.331 605.317,469.015 607.668,427.73 610.018,367.43 612.369,367.279 614.719,467.914 617.07,381.43 619.42,455.128 621.771,500.883 624.121,387.899 626.472,577.277 628.822,566.314 631.173,371.698 633.523,466.822 635.874,457.528 638.224,487.315 640.575,424.299 642.925,600.675 645.275,592.178 647.626,576.526 649.976,366.382 652.327,504.239 654.677,502.608 657.028,414.76 659.378,295.99 661.729,368.203 664.079,414.476 666.43,367.556 668.78,454.424 671.131,530.374 673.481,337.835 675.832,391.273 678.182,374.229 680.533,439.022 682.883,231.409 685.233,424.232 687.584,291.349 689.934,518.611 692.285,469.888 694.635,578.15 696.986,549.944 699.336,310.013 701.687,451.863 704.037,265.809 706.388,411.324 708.738,440.8 711.089,585.856 713.439,401.927 715.79,442.715 718.14,647.577 720.491,411.283 722.841,546.986 725.192,277.362 727.542,509.589 729.892,523.733 732.243,486.131 734.593,559.083 736.944,357.451 739.294,437.99 741.645,534.618 743.995,364.723 746.346,357.994 748.696,368.715 751.047,248.318 753.397,399.357 755.748,254.483 758.098,511.785 760.449,345.456 762.799,543.825 765.15,277.609 767.5,635.458 769.85,413.602 772.201,294.759 774.551,264.183 776.902,449.633 779.252,356.454 781.603,333.341 783.953,453.818 786.304,415.231 788.654,597.581 791.005,533.206 793.355,428.199 795.706,483.17 798.056,323.299 800.407,431.483 802.757,451.947 805.108,497.208 807.458,631.091 809.809,383.656 812.159,589.683 814.509,396.016 816.86,302.403 819.21,477.344 821.561,488.822 823.911,478.354 826.262,344.034 828.612,549.598 830.963,496.804 833.313,456.057 835.664,564.981 838.014,245.919 840.365,221.553 842.715,391.376 845.066,435.222 847.416,547.708 849.767,512.396 852.117,445.155 854.467,411.305 856.818,385.366 859.168,433.934 861.519,441.088 863.869,372.844 866.22,415.807 868.57,389.795 870.921,445.715 873.271,484.171 875.622,478.646 877.972,277.577 880.323,478.718 882.673,244.036 885.024,429.504 887.374,399.361 889.725,530.011 892.075,573.742 894.426,492.036 896.776,356.869 899.126,476.066 901.477,510.776 903.827,562.905 906.178,455.128 908.528,527.907 910.879,245.925 913.229,496.697 915.58,370.702 917.93,690.907 920.281,362.593 922.631,467.076 924.982,356.495 927.332,430.98 929.683,593.994 932.033,411.342 934.384,419.75 936.734,416.35 939.084,613.588 941.435,326.183 943.785,532.114 946.136,226.263 948.486,255.461 950.837,96.8724 953.187,324.939 955.538,436.478 957.888,560.925 960.239,361.676 962.589,409.115 964.94,357.437 967.29,405.7 969.641,465.515 971.991,464.015 974.342,515.182 976.692,541.359 979.043,555.453 981.393,391.706 983.743,555.603 986.094,454.111 988.444,571.367 990.795,430.911 993.145,291.22 995.496,510.821 997.846,456.655 1000.2,528.862 1002.55,297.978 1004.9,350.437 1007.25,571.909 1009.6,484.73 1011.95,312.606 1014.3,454.047 1016.65,389.343 1019,468.545 1021.35,578.472 1023.7,570.451 1026.05,505.304 1028.4,288.927 1030.75,358.765 1033.1,475.122 1035.45,633.039 1037.8,562.167 1040.15,385.387 1042.51,385.238 1044.86,366.609 1047.21,224.268 1049.56,448.952 1051.91,395.286 1054.26,272.445 1056.61,476.618 1058.96,577.817 1061.31,490.326 1063.66,302.694 1066.01,608.164 1068.36,457.27 1070.71,503.796 1073.06,340.123 1075.41,300.773 1077.76,357.918 1080.11,507.46 1082.46,467.599 1084.81,416.084 1087.16,608.99 1089.51,557.224 1091.87,538.993 1094.22,434.494 1096.57,304.581 1098.92,446.597 1101.27,335.281 1103.62,591.518 1105.97,509.167 1108.32,383.68 1110.67,480.557 1113.02,374.974 1115.37,351.377 1117.72,539.672 1120.07,376.306 1122.42,352.605 1124.77,482.653 1127.12,405.588 1129.47,371.022 1131.82,504.118 1134.17,472.42 1136.52,252.49 1138.87,342.086 1141.23,319.065 1143.58,446.483 1145.93,472.372 1148.28,263.22 1150.63,380.962 1152.98,476.148 1155.33,677.704 1157.68,326.676 1160.03,306.501 1162.38,253.284 1164.73,457.859 1167.08,544.396 1169.43,474.26 1171.78,442.757 1174.13,413.406 1176.48,497.367 1178.83,470.317 1181.18,515.384 1183.53,430.001 1185.88,369.39 1188.23,519.212 1190.59,492.42 1192.94,369.887 1195.29,462.787 1197.64,412.349 1199.99,430.713 1202.34,339.945 1204.69,519.386 1207.04,390.578 1209.39,396.007 1211.74,393.542 1214.09,237.981 1216.44,288.89 1218.79,586.816 1221.14,363.599 1223.49,280.376 1225.84,634.986 1228.19,325.03 1230.54,497.143 1232.89,618.006 1235.24,507.484 1237.59,389.693 1239.94,474.188 1242.3,396.567 1244.65,764.396 1247,357 1249.35,488.72 1251.7,241.378 1254.05,354.972 1256.4,528.771 1258.75,501.381 1261.1,353.377 1263.45,551.271 1265.8,528.424 1268.15,428.587 1270.5,291.067 1272.85,474.391 1275.2,527.902 1277.55,324.241 1279.9,430.667 1282.25,505.828 1284.6,339.055 1286.95,414.371 1289.3,306.082 1291.66,441.135 1294.01,295.159 1296.36,669.954 1298.71,590.042 1301.06,572.358 1303.41,521.451 1305.76,512.845 1308.11,233.838 1310.46,614.856 1312.81,462.2 1315.16,463.706 1317.51,238.979 1319.86,549.033 1322.21,411.427 1324.56,342.782 1326.91,510.417 1329.26,478.989 1331.61,562.348 1333.96,422.991 1336.31,711.958 1338.66,228.446 1341.02,464.316 1343.37,547.721 1345.72,573.371 1348.07,300.192 1350.42,433.26 1352.77,501.283 1355.12,480.669 1357.47,397.534 1359.82,430.623 1362.17,356.165 1364.52,365.611 1366.87,518.208 1369.22,402.85 1371.57,581.746 1373.92,347.366 1376.27,464.696 1378.62,385.67 1380.97,407.774 1383.32,387.36 1385.67,385.081 1388.02,459.197 1390.38,411.869 1392.73,639.632 1395.08,565.63 1397.43,601.966 1399.78,362.514 1402.13,497.697 1404.48,580.476 1406.83,350.659 1409.18,456.837 1411.53,417.991 1413.88,380.678 1416.23,410.791 1418.58,513.16 1420.93,471.759 1423.28,322.587 1425.63,231.416 1427.98,341.965 1430.33,368.932 1432.68,335.133 1435.03,449.617 1437.38,391.756 1439.74,269.021 1442.09,528.518 1444.44,563.452 1446.79,410.219 1449.14,614.31 1451.49,524.072 1453.84,549.084 1456.19,530.502 1458.54,578.71 1460.89,351.103 1463.24,301.923 1465.59,599.219 1467.94,567.47 1470.29,292.318 1472.64,277.895 1474.99,530.53 1477.34,373.884 1479.69,446.644 1482.04,360.995 1484.39,252.03 1486.74,428.965 1489.1,336.303 1491.45,328.93 1493.8,593.978 1496.15,550.39 1498.5,522.376 1500.85,374.193 1503.2,355.295 1505.55,531.25 1507.9,469.79 1510.25,450.295 1512.6,282.463 1514.95,570.444 1517.3,433.472 1519.65,495.553 1522,333.456 1524.35,276.431 1526.7,511.562 1529.05,358.876 1531.4,510.956 1533.75,409.332 1536.1,537.593 1538.45,515.184 1540.81,376.609 1543.16,372.327 1545.51,423.523 1547.86,410.884 1550.21,437.576 1552.56,444.98 1554.91,466.919 1557.26,428.926 1559.61,458.427 1561.96,358.301 1564.31,355.576 1566.66,463.376 1569.01,381.051 1571.36,477.865 1573.71,499.208 1576.06,358.882 1578.41,215.963 1580.76,455.506 1583.11,443.832 1585.46,500.067 1587.81,321.491 1590.17,539.201 1592.52,387.543 1594.87,331.49 1597.22,309.578 1599.57,560.26 1601.92,467.094 1604.27,362.034 1606.62,378.043 1608.97,329.537 1611.32,285.449 1613.67,271.765 1616.02,426.695 1618.37,425.364 1620.72,518.126 1623.07,518.306 1625.42,430.814 1627.77,537.388 1630.12,402.556 1632.47,543.831 1634.82,463.587 1637.17,494.653 1639.53,487.035 1641.88,518.882 1644.23,327.862 1646.58,322.188 1648.93,371.708 1651.28,351.098 1653.63,404.211 1655.98,253.612 1658.33,270.01 1660.68,470.686 1663.03,464.941 1665.38,684.293 1667.73,426.759 1670.08,444.533 1672.43,360.797 1674.78,285.42 1677.13,311.97 1679.48,400.551 1681.83,447.204 1684.18,425.255 1686.53,410.517 1688.89,459.608 1691.24,398.332 1693.59,416.378 1695.94,454.836 1698.29,318.365 1700.64,335.472 1702.99,533.176 1705.34,493.144 1707.69,333.039 1710.04,416.331 1712.39,617.182 1714.74,506.203 1717.09,372.235 1719.44,390.36 1721.79,290.277 1724.14,498.432 1726.49,354.139 1728.84,472.317 1731.19,479.95 1733.54,440.509 1735.89,353.202 1738.25,326.67 1740.6,326.212 1742.95,454.424 1745.3,414.437 1747.65,418.407 1750,582.355 1752.35,483.102 1754.7,449.277 1757.05,458.133 1759.4,480.121 1761.75,343.967 1764.1,533.74 1766.45,443.088 1768.8,345.024 1771.15,329.477 1773.5,401.196 1775.85,315.54 1778.2,481.355 1780.55,346.028 1782.9,449.191 1785.25,218.555 1787.6,451.624 1789.96,372.732 1792.31,581.669 1794.66,562.007 1797.01,447.043 1799.36,548.249 1801.71,366.964 1804.06,416.162 1806.41,514.234 1808.76,343.996 1811.11,344.663 1813.46,419.69 1815.81,321.049 1818.16,519.587 1820.51,523.954 1822.86,341.02 1825.21,367.39 1827.56,294.852 1829.91,471.467 1832.26,502.407 1834.61,438.03 1836.96,352.566 1839.32,380.456 1841.67,418.463 1844.02,532.938 1846.37,404.761 1848.72,392.28 1851.07,400.84 1853.42,382.928 1855.77,559.319 1858.12,539.739 1860.47,614.909 1862.82,578.86 1865.17,403.255 1867.52,440.415 1869.87,459.247 1872.22,444.73 1874.57,443.327 1876.92,435.059 1879.27,392.379 1881.62,444.565 1883.97,424.871 1886.32,447.636 1888.68,318.174 1891.03,480.569 1893.38,317.573 1895.73,436.922 1898.08,353.367 1900.43,322.415 1902.78,474.984 1905.13,432.171 1907.48,378.685 1909.83,256.647 1912.18,419.636 1914.53,319.82 1916.88,651.104 1919.23,338.55 1921.58,383.317 1923.93,384.519 1926.28,504.082 1928.63,361.646 1930.98,497.942 1933.33,411.461 1935.68,336.6 1938.04,345.411 1940.39,610.6 1942.74,483.53 1945.09,459.914 1947.44,475.261 1949.79,406.277 1952.14,385.179 1954.49,375.617 1956.84,366.467 1959.19,353.861 1961.54,381.4 1963.89,481.95 1966.24,441.593 1968.59,456.693 1970.94,180.079 1973.29,471.905 1975.64,509.906 1977.99,391.811 1980.34,406.412 1982.69,475.069 1985.04,354.06 1987.4,433.496 1989.75,538.068 1992.1,272.061 1994.45,235.144 1996.8,418.415 1999.15,593.304 2001.5,530.436 2003.85,303.88 2006.2,569.498 2008.55,521.64 2010.9,374.001 2013.25,395.02 2015.6,504.421 2017.95,562.413 2020.3,665.079 2022.65,354.317 2025,536.772 2027.35,388.729 2029.7,500.821 2032.05,526.955 2034.4,527.523 2036.76,571.011 2039.11,405.634 2041.46,558.272 2043.81,603.857 2046.16,403.675 2048.51,350.469 2050.86,430.807 2053.21,568.364 2055.56,547.739 2057.91,295.453 2060.26,387.546 2062.61,319.199 2064.96,428.266 2067.31,521.728 2069.66,416.035 2072.01,402.279 2074.36,441.811 2076.71,407.021 2079.06,390.138 2081.41,417.129 2083.76,468.927 2086.11,457.787 2088.47,488.501 2090.82,442.582 2093.17,394.85 2095.52,455.52 2097.87,280.98 2100.22,354.728 2102.57,348.962 2104.92,497.632 2107.27,436.777 2109.62,714.883 2111.97,394.666 2114.32,437.053 2116.67,434.383 2119.02,672.487 2121.37,504.299 2123.72,453.577 2126.07,378.037 2128.42,524.722 2130.77,384.736 2133.12,668.618 2135.47,340.875 2137.83,572.916 2140.18,304.103 2142.53,407.789 2144.88,322.037 2147.23,526.116 2149.58,316.777 2151.93,259.027 2154.28,279.867 2156.63,385.191 2158.98,373.742 2161.33,465.607 2163.68,368.859 2166.03,340.977 2168.38,444.503 2170.73,584.279 2173.08,313.156 2175.43,456.021 2177.78,334.138 2180.13,462.348 2182.48,260.453 2184.83,487.301 2187.19,482.333 2189.54,483.641 2191.89,455.089 2194.24,464.965 2196.59,347.087 2198.94,424.824 2201.29,283.959 2203.64,375.74 2205.99,493.001 2208.34,480.471 2210.69,296.521 2213.04,435.721 2215.39,335.202 2217.74,525.307 2220.09,200.727 2222.44,478.135 2224.79,499.967 2227.14,281.761 2229.49,423.25 2231.84,209.011 2234.19,221.651 2236.55,368.478 2238.9,529.34 2241.25,344.235 2243.6,382.119 2245.95,459.332 2248.3,579.061 2250.65,358.75 2253,370.103 2255.35,537.089 2257.7,362.521 2260.05,531.509 2262.4,605.805 2264.75,233.266 2267.1,446.149 2269.45,267.501 2271.8,339.558 2274.15,394.829 2276.5,598.654 2278.85,419.971 2281.2,436.786 2283.55,214.363 2285.91,515.764 2288.26,382.421 2290.61,297.655 2292.96,406.396 2295.31,323.201 2297.66,232.865 2300.01,516.679 2302.36,393.316 2304.71,364.661 2307.06,396.873 2309.41,345.482 2311.76,432.634 2314.11,463.893 2316.46,345.167 2318.81,327.175 2321.16,553.854 2323.51,558.886 2325.86,371.271 2328.21,243.919 2330.56,482.735 2332.91,545.794 2335.27,486.99 2337.62,498.807 2339.97,486.606 2342.32,527.666 2344.67,483.999 2347.02,445.179 2349.37,380.323 2351.72,458.044 2354.07,595.712 2356.42,598.605 2358.77,365.13 2361.12,261.718 2363.47,533.104 2365.82,527 2368.17,186.206 2370.52,392.683 2372.87,527.893 2375.22,382.805 2377.57,308.165 2379.92,213.489 2382.27,515.512 2384.62,410.634 2386.98,411.95 2389.33,417.391 2391.68,440.258 2394.03,662.139 2396.38,489.935 2398.73,687.01 2401.08,568.249 2403.43,553.425 2405.78,542.61 2408.13,386.034 2410.48,413.954 2412.83,289.182 2415.18,393.289 2417.53,383.301 2419.88,430.401 2422.23,461.696 2424.58,423.382 2426.93,439.865 2429.28,400.687 2431.63,471.29 2433.98,539.907 2436.34,446.977 2438.69,488.151 2441.04,452.29 2443.39,390.727 2445.74,378.374 2448.09,504.731 2450.44,387.776 2452.79,534.122 2455.14,477.786 2457.49,444.923 2459.84,537.397 2462.19,174.157 2464.54,412.023 2466.89,651.299 2469.24,272.301 2471.59,476.9 2473.94,464.426 2476.29,507.369 2478.64,516.098 2480.99,520.926 2483.34,539.783 2485.7,457.862 2488.05,266.745 2490.4,441.07 2492.75,477.763 2495.1,410.798 2497.45,415.9 2499.8,590.078 2502.15,319.816 2504.5,373.931 2506.85,517.419 2509.2,548.871 2511.55,522.149 2513.9,465.652 2516.25,532.612 2518.6,499.135 2520.95,528.952 2523.3,374.612 2525.65,413.44 2528,303.912 2530.35,311.82 2532.7,455.797 2535.06,449.147 2537.41,467.239 2539.76,631.497 2542.11,410.359 2544.46,438.08 2546.81,526.99 2549.16,383.695 2551.51,596.098 2553.86,318.308 2556.21,484.769 2558.56,425.933 2560.91,471.346 2563.26,445.529 2565.61,513.658 2567.96,447.804 2570.31,473.759 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.91115   -2.56434  -2.37666   …  -3.5575     -3.36562  -3.71999
  0.873646   1.17814  -0.520702     -0.0236822   1.20571  -0.277159
  3.25412    3.1074    3.91939       4.84642     3.62042   5.5387

[:, :, 2] =
 -1.58754  -2.7571    -4.59247   -5.9107   …  -4.12326   -4.05143   -2.94073
 -1.01126   0.161591   0.579903   1.56583      0.358231   0.187159  -1.82149
  2.15825   2.29987    3.8018     4.3873       4.66091    4.65861    5.3426

[:, :, 3] =
 -3.53119  -4.21254   -3.88631   -3.96828   …  -5.20228  -4.86537   -3.54897
 -1.03406  -0.339305   0.221756   0.253311      0.6361   -0.232398  -0.688273
  3.02672   6.84094    5.21149    4.63402       6.32973   5.59232    5.73197

[:, :, 4] =
 -4.67676  -5.11015   -4.20659  -3.35938   …  -4.74086   -4.74086   -3.96443
  1.13057   0.974677   1.36054  -0.637372      0.681563   0.681563   0.411077
  1.597     3.298      4.88371   4.73542       5.15318    5.15318    3.66123</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.98615     1.0041
 -0.00186954  0.98246
  4.98892     1.00255</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.48 seconds
Compute duration  = 2.48 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -4.9972    0.9954    0.0179   3099.8766   4750.3611    1.0003   ⋯
        x[2]    0.0099    0.9899    0.0175   3216.5436   4801.6043    1.0001   ⋯
        x[3]    4.9749    0.9739    0.0172   3205.9377   5349.6147    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9344   -5.6695   -4.9965   -4.3243   -3.0417
        x[2]   -1.9413   -0.6443    0.0147    0.6625    1.9586
        x[3]    3.0687    4.3025    4.9902    5.6396    6.8473</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.42 seconds
Compute duration  = 1.42 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5007    0.1887    0.0028   4530.7127   5672.4737    0.9999   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1435    0.3606    0.5029    0.6420    0.8487</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.23 seconds
Compute duration  = 0.23 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.4808    0.1434    0.0115   115.8260    39.2119    1.0061     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.2373    0.3619    0.4806    0.5990    0.7182</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.038393350922891756,1.0,0.0), "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.038393350922891756,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/uuqsE/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/uuqsE/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/uuqsE/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/uuqsE/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/uuqsE/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/DvdZw/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, __context__::DynamicPPL.DefaultContext)
    @ Main.Notebook ~/work/turing-docs/turing-docs/tutorials/docs-17-implementing-samplers/index.qmd:593
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/DvdZw/src/model.jl:973 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, context::DynamicPPL.DefaultContext)
    @ DynamicPPL ~/.julia/packages/DynamicPPL/DvdZw/src/model.jl:962
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/DvdZw/src/model.jl:892 [inlined]
 [11] logdensity
    @ ~/.julia/packages/DynamicPPL/DvdZw/src/logdensityfunction.jl:140 [inlined]
 [12] Fix1
    @ ./operators.jl:1118 [inlined]
 [13] vector_mode_dual_eval!(f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::Vector{Float64})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/PcZ48/src/apiutils.jl:24
 [14] vector_mode_gradient!(result::DiffResults.MutableDiffResult{1, Float64, Tuple{Vector{Float64}}}, f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, x::Vector{Float64}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:96
 [15] gradient!
    @ ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:37 [inlined]
 [16] gradient!
    @ ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:35 [inlined]
 [17] logdensity_and_gradient
    @ ~/.julia/packages/LogDensityProblemsAD/CvDZt/ext/LogDensityProblemsADForwardDiffExt.jl:116 [inlined]
 [18] leapfrog_step(model::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, x::Vector{Float64}, p::Vector{Float64}, ϵ::Int64, M::UniformScaling{Bool})
    @ Main.Notebook ~/work/turing-docs/turing-docs/tutorials/docs-17-implementing-samplers/index.qmd:369
 [19] step(rng::TaskLocalRNG, model_wrapper::AbstractMCMC.LogDensityModel{LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}, sampler::MALA{Int64, UniformScaling{Bool}}, state::MALAState{Vector{Float64}}; kwargs::@Kwargs{})
    @ Main.Notebook ~/work/turing-docs/turing-docs/tutorials/docs-17-implementing-samplers/index.qmd:334
 [20] step
    @ ~/work/turing-docs/turing-docs/tutorials/docs-17-implementing-samplers/index.qmd:316 [inlined]
 [21] #step#107
    @ ~/.julia/packages/Turing/QN7BL/src/mcmc/abstractmcmc.jl:161 [inlined]
 [22] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, state::Turing.Inference.TuringState{MALAState{Vector{Float64}}, LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}})
    @ Turing.Inference ~/.julia/packages/Turing/QN7BL/src/mcmc/abstractmcmc.jl:150
 [23] macro expansion
    @ ~/.julia/packages/AbstractMCMC/z1nwm/src/sample.jl:217 [inlined]
 [24] macro expansion
    @ ~/.julia/packages/AbstractMCMC/z1nwm/src/logging.jl:16 [inlined]
 [25] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, num_warmup::Int64, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/z1nwm/src/sample.jl:142
 [26] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/DvdZw/src/sampler.jl:93
 [27] sample
    @ ~/.julia/packages/DynamicPPL/DvdZw/src/sampler.jl:83 [inlined]
 [28] #sample#4
    @ ~/.julia/packages/Turing/QN7BL/src/mcmc/Inference.jl:276 [inlined]
 [29] sample
    @ ~/.julia/packages/Turing/QN7BL/src/mcmc/Inference.jl:267 [inlined]
 [30] #sample#3
    @ ~/.julia/packages/Turing/QN7BL/src/mcmc/Inference.jl:264 [inlined]
 [31] top-level scope
    @ ~/work/turing-docs/turing-docs/tutorials/docs-17-implementing-samplers/index.qmd:595</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.55 seconds
Compute duration  = 0.55 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8575    0.5747    0.0304   243.0443   116.7887    1.0063     ⋯
           x    0.0610    1.0703    0.0680   397.0680   227.6913    1.0080     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.0964    0.3878    0.7376    1.2180    2.1545
           x   -2.1434   -0.3997    0.0222    0.4185    2.7357</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.85 seconds
Compute duration  = 2.85 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8681    0.5971    0.0318   258.5161   206.6387    1.0032     ⋯
           x   -0.0559    1.0650    0.0566   454.3364   336.8658    1.0029     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1431    0.3949    0.7386    1.2203    2.4041
           x   -2.6199   -0.4508   -0.0332    0.3916    2.1054</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>